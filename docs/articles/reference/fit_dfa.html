<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit a Bayesian DFA — fit_dfa • bayesdfa</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit a Bayesian DFA — fit_dfa" />
<meta property="og:description" content="Fit a Bayesian DFA" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesdfa</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bayesdfa.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/combining_data.html">Combining data with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/compositional.html">Fitting compositional dynamic factor models with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/covariates.html">Examples of including covariates with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/estimate_process_sigma.html">Estimating process trend variability with bayesdfa</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/fate-ewi/bayesdfa/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a Bayesian DFA</h1>
    <small class="dont-index">Source: <a href='https://github.com/fate-ewi/bayesdfa/blob/master/R/fit_dfa.R'><code>R/fit_dfa.R</code></a></small>
    <div class="hidden name"><code>fit_dfa.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit a Bayesian DFA</p>
    </div>

    <pre class="usage"><span class='fu'>fit_dfa</span><span class='op'>(</span>
  y <span class='op'>=</span> <span class='va'>y</span>,
  num_trends <span class='op'>=</span> <span class='fl'>1</span>,
  varIndx <span class='op'>=</span> <span class='cn'>NULL</span>,
  zscore <span class='op'>=</span> <span class='cn'>TRUE</span>,
  iter <span class='op'>=</span> <span class='fl'>2000</span>,
  chains <span class='op'>=</span> <span class='fl'>4</span>,
  thin <span class='op'>=</span> <span class='fl'>1</span>,
  control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>adapt_delta <span class='op'>=</span> <span class='fl'>0.99</span>, max_treedepth <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>,
  nu_fixed <span class='op'>=</span> <span class='fl'>101</span>,
  est_correlation <span class='op'>=</span> <span class='cn'>FALSE</span>,
  estimate_nu <span class='op'>=</span> <span class='cn'>FALSE</span>,
  estimate_trend_ar <span class='op'>=</span> <span class='cn'>FALSE</span>,
  estimate_trend_ma <span class='op'>=</span> <span class='cn'>FALSE</span>,
  estimate_process_sigma <span class='op'>=</span> <span class='cn'>FALSE</span>,
  equal_process_sigma <span class='op'>=</span> <span class='cn'>TRUE</span>,
  sample <span class='op'>=</span> <span class='cn'>TRUE</span>,
  data_shape <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"wide"</span>, <span class='st'>"long"</span><span class='op'>)</span>,
  obs_covar <span class='op'>=</span> <span class='cn'>NULL</span>,
  pro_covar <span class='op'>=</span> <span class='cn'>NULL</span>,
  z_bound <span class='op'>=</span> <span class='cn'>NULL</span>,
  z_model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"dfa"</span>, <span class='st'>"proportion"</span><span class='op'>)</span>,
  trend_model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"rw"</span>, <span class='st'>"spline"</span>, <span class='st'>"gp"</span><span class='op'>)</span>,
  n_knots <span class='op'>=</span> <span class='cn'>NULL</span>,
  knot_locs <span class='op'>=</span> <span class='cn'>NULL</span>,
  par_list <span class='op'>=</span> <span class='cn'>NULL</span>,
  family <span class='op'>=</span> <span class='st'>"gaussian"</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>,
  gp_theta_prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>1</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>y</th>
      <td><p>A matrix of data to fit. See <code>data_shape</code> option to specify whether
this is long or wide format data. Wide format data (default) is a matrix with
time across columns and unique time series across rows, and can only contain 1 observation
per time series - time combination. In contrast, long format data is a data frame that includes
observations ("obs"), time ("time") and time series ("ts") identifiers -- the benefit of long
format is that multiple observations per time series can be included. Correlation matrix currently
not estimated if data shape is long.</p></td>
    </tr>
    <tr>
      <th>num_trends</th>
      <td><p>Number of trends to fit.</p></td>
    </tr>
    <tr>
      <th>varIndx</th>
      <td><p>Indices indicating which timeseries should have shared
variances.</p></td>
    </tr>
    <tr>
      <th>zscore</th>
      <td><p>Logical. Should the data be standardized first? If not it is
just centered. Centering is necessary because no intercept is included.</p></td>
    </tr>
    <tr>
      <th>iter</th>
      <td><p>Number of iterations in Stan sampling, defaults to 2000.</p></td>
    </tr>
    <tr>
      <th>chains</th>
      <td><p>Number of chains in Stan sampling, defaults to 4.</p></td>
    </tr>
    <tr>
      <th>thin</th>
      <td><p>Thinning rate in Stan sampling, defaults to 1.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>A list of options to pass to Stan sampling. Defaults to
<code><a href='https://rdrr.io/r/base/list.html'>list(adapt_delta = 0.99, max_treedepth = 20)</a></code>.</p></td>
    </tr>
    <tr>
      <th>nu_fixed</th>
      <td><p>Student t degrees of freedom parameter. If specified as
greater than 100, a normal random walk is used instead of a random walk
with a t-distribution. Defaults to <code>101</code>.</p></td>
    </tr>
    <tr>
      <th>est_correlation</th>
      <td><p>Boolean, whether to estimate correlation of
observation error matrix <code>R</code>. Defaults to <code>FALSE</code>. Currently can't be estimated if data are in long format.</p></td>
    </tr>
    <tr>
      <th>estimate_nu</th>
      <td><p>Logical. Estimate the student t degrees of freedom
parameter? Defaults to <code>FALSE</code>,</p></td>
    </tr>
    <tr>
      <th>estimate_trend_ar</th>
      <td><p>Logical. Estimate AR(1) parameters on DFA trends?
Defaults to `FALSE``, in which case AR(1) parameters are set to 1</p></td>
    </tr>
    <tr>
      <th>estimate_trend_ma</th>
      <td><p>Logical. Estimate MA(1) parameters on DFA trends?
Defaults to `FALSE``, in which case MA(1) parameters are set to 0.</p></td>
    </tr>
    <tr>
      <th>estimate_process_sigma</th>
      <td><p>Logical. Defaults FALSE, whether or not to estimate process error sigma. If not estimated,
sigma is fixed at 1, like conventional DFAs.</p></td>
    </tr>
    <tr>
      <th>equal_process_sigma</th>
      <td><p>Logical. If process sigma is estimated, whether or not to estimate a single shared value across trends (default)
or estimate equal values for each trend</p></td>
    </tr>
    <tr>
      <th>sample</th>
      <td><p>Logical. Should the model be sampled from? If <code>FALSE</code>, then the
data list object that would have been passed to Stan is returned instead.
This is useful for debugging and simulation. Defaults to <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>data_shape</th>
      <td><p>If <code>wide</code> (the current default) then the input data should
have rows representing the various timeseries and columns representing the
values through time. This matches the MARSS input data format. If <code>long</code>
then the long format data is a data frame that includes observations ("obs"),
time ("time") and time series ("ts") identifiers -- the benefit of long
format is that multiple observations per time series can be included</p></td>
    </tr>
    <tr>
      <th>obs_covar</th>
      <td><p>Optional dataframe of data with 4 named columns ("time","timeseries","covariate","value"), representing: (1) time, (2) the time series
affected, (3) the covariate number for models with more than one covariate affecting each
trend, and (4) the value of the covariate</p></td>
    </tr>
    <tr>
      <th>pro_covar</th>
      <td><p>Optional dataframe of data with 4 named columns ("time","trend","covariate","value"), representing: (1) time, (2) the trend
affected, (3) the covariate number for models with more than one covariate affecting each
trend, and (4) the value of the covariate</p></td>
    </tr>
    <tr>
      <th>z_bound</th>
      <td><p>Optional hard constraints for estimated factor loadings -- really only applies to model with 1 trend. Passed in as a 2-element vector representing the lower and upper bound, e.g. (0, 100) to constrain positive</p></td>
    </tr>
    <tr>
      <th>z_model</th>
      <td><p>Optional argument allowing for elements of Z to be constrained to be proportions (each time series modeled as a mixture of trends). Arguments can be "dfa" (default) or "proportion"</p></td>
    </tr>
    <tr>
      <th>trend_model</th>
      <td><p>Optional argument to change the model of the underlying latent trend. By default this is set to 'rw', where the trend
is modeled as a random walk - as in conentional DFA. Alternative options are 'spline', where B-splines are used to model the trends
or 'gp', where gaussian predictive processes are used. If models other than 'rw' are used, there are some key points. First, the MA and AR
parameters on these models will be turned off. Second, for B-splines the process_sigma becomes an optional scalar on the spline coefficients,
and is turned off by default. Third, the number of knots can be specified (more knots = more wiggliness, and n_knots &lt; N). For models
with &gt; 2 trends, each trend has their own spline coefficients estimated though the knot locations are assumed shared. If knots aren't specified,
the default is N/3.</p></td>
    </tr>
    <tr>
      <th>n_knots</th>
      <td><p>The number of knots for the B-spline of Gaussian predictive process models. Optional, defaults to round(N/3)</p></td>
    </tr>
    <tr>
      <th>knot_locs</th>
      <td><p>Locations of knots (optional), defaults to uniform spacing between 1 and N</p></td>
    </tr>
    <tr>
      <th>par_list</th>
      <td><p>A vector of parameter names of variables to be estimated by Stan. If NULL, this will default to
c("x", "Z", "sigma", "log_lik", "psi","xstar") for most models -- though if AR / MA, or Student-t models are used
additional parameters will be monitored. If you want to use diagnostic tools in rstan, including moment_matching,
you will need to pass in a larger list. Setting this argument to "all" will monitor all parameters, enabling the use
of diagnostic functions -- but making the models a lot larger for storage. Finally, this argument may be a custom string
of parameters to monitor, e.g. c("x","sigma")</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>String describing the observation model. Default is "gaussian",
but included options are "gamma", "lognormal", negative binomial ("nbinom2"),
"poisson", or "binomial". The binomial family is assumed to have logit link,
gaussian family is assumed to be identity, and the rest are log-link.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Whether to print iterations and information from Stan, defaults to FALSE.</p></td>
    </tr>
    <tr>
      <th>gp_theta_prior</th>
      <td><p>A 2-element vector controlling the prior on the Gaussian process parameter in cov_exp_quad.
This prior is a half-Student t prior, with the first argument of gp_theta_prior being the degrees of freedom (nu),
and the second element being the standard deviation</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Any other arguments to pass to <code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html'>rstan::sampling()</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Note that there is nothing restricting the loadings and trends from
being inverted (i.e. multiplied by <code>-1</code>) for a given chain. Therefore, if
you fit multiple chains, the package will attempt to determine which chains
need to be inverted using the function <code><a href='find_inverted_chains.html'>find_inverted_chains()</a></code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>plot_loadings plot_trends rotate_trends find_swans</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>42</span><span class='op'>)</span>
<span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_dfa.html'>sim_dfa</a></span><span class='op'>(</span>num_trends <span class='op'>=</span> <span class='fl'>1</span>, num_years <span class='op'>=</span> <span class='fl'>20</span>, num_ts <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='co'># only 1 chain and 250 iterations used so example runs quickly:</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>fit_dfa</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span>, iter <span class='op'>=</span> <span class='fl'>50</span>, chains <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt; SAMPLING FOR MODEL 'dfa' NOW (CHAIN 1).
#&gt; Chain 1: 
#&gt; Chain 1: Gradient evaluation took 3.3e-05 seconds
#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.33 seconds.
#&gt; Chain 1: Adjust your expectations accordingly!
#&gt; Chain 1: 
#&gt; Chain 1: 
#&gt; Chain 1: WARNING: There aren't enough warmup iterations to fit the
#&gt; Chain 1:          three stages of adaptation as currently configured.
#&gt; Chain 1:          Reducing each adaptation stage to 15%/75%/10% of
#&gt; Chain 1:          the given number of warmup iterations:
#&gt; Chain 1:            init_buffer = 3
#&gt; Chain 1:            adapt_window = 20
#&gt; Chain 1:            term_buffer = 2
#&gt; Chain 1: 
#&gt; Chain 1: Iteration:  1 / 50 [  2%]  (Warmup)
#&gt; Chain 1: Iteration:  5 / 50 [ 10%]  (Warmup)
#&gt; Chain 1: Iteration: 10 / 50 [ 20%]  (Warmup)
#&gt; Chain 1: Iteration: 15 / 50 [ 30%]  (Warmup)
#&gt; Chain 1: Iteration: 20 / 50 [ 40%]  (Warmup)
#&gt; Chain 1: Iteration: 25 / 50 [ 50%]  (Warmup)
#&gt; Chain 1: Iteration: 26 / 50 [ 52%]  (Sampling)
#&gt; Chain 1: Iteration: 30 / 50 [ 60%]  (Sampling)
#&gt; Chain 1: Iteration: 35 / 50 [ 70%]  (Sampling)
#&gt; Chain 1: Iteration: 40 / 50 [ 80%]  (Sampling)
#&gt; Chain 1: Iteration: 45 / 50 [ 90%]  (Sampling)
#&gt; Chain 1: Iteration: 50 / 50 [100%]  (Sampling)
#&gt; Chain 1: 
#&gt; Chain 1:  Elapsed Time: 0.00252 seconds (Warm-up)
#&gt; Chain 1:                0.004879 seconds (Sampling)
#&gt; Chain 1:                0.007399 seconds (Total)
#&gt; Chain 1: </div><div class='output co'>#&gt; <span class='warning'>Warning: There were 1 chains where the estimated Bayesian Fraction of Missing Information was low. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#bfmi-low</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Examine the pairs() plot to diagnose sampling problems</span></div><div class='output co'>#&gt; <span class='warning'>Warning: The largest R-hat is 2.1, indicating chains have not mixed.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#r-hat</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#bulk-ess</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#tail-ess</span></div><div class='output co'>#&gt; Inference for the input samples (1 chains: each with iter = 25; warmup = 12):
#&gt; 
#&gt;                   Q5     Q50     Q95    Mean     SD  Rhat Bulk_ESS Tail_ESS
#&gt; x[1,1]          -1.0    -1.0    -1.0    -1.0    0.0  1.13        6       13
#&gt; x[1,2]           0.2     0.2     0.2     0.2    0.0  1.48        5       13
#&gt; x[1,3]          -1.1    -1.1    -1.1    -1.1    0.0  1.87        4       13
#&gt; x[1,4]          -1.3    -1.3    -1.3    -1.3    0.0  1.87        4       13
#&gt; x[1,5]           0.1     0.1     0.1     0.1    0.0  2.06        4       13
#&gt; x[1,6]          -1.0    -1.0    -1.0    -1.0    0.0  2.06        4       13
#&gt; x[1,7]          -0.1    -0.1    -0.1    -0.1    0.0  2.06        4       13
#&gt; x[1,8]          -1.5    -1.5    -1.4    -1.5    0.0  2.06        4       13
#&gt; x[1,9]          -0.7    -0.7    -0.7    -0.7    0.0  2.06        4       13
#&gt; x[1,10]         -1.9    -1.9    -1.9    -1.9    0.0  2.06        4       13
#&gt; x[1,11]         -2.5    -2.5    -2.5    -2.5    0.0  2.06        4       13
#&gt; x[1,12]         -2.0    -2.0    -2.0    -2.0    0.0  2.06        4       13
#&gt; x[1,13]         -1.1    -1.1    -1.1    -1.1    0.0  2.06        4       13
#&gt; x[1,14]         -0.5    -0.5    -0.5    -0.5    0.0  1.48        4       13
#&gt; x[1,15]          0.1     0.1     0.1     0.1    0.0  1.13        7       13
#&gt; x[1,16]          0.9     0.9     0.9     0.9    0.0  1.58        8       13
#&gt; x[1,17]          1.9     1.9     1.9     1.9    0.0  1.06        9       13
#&gt; x[1,18]          2.0     2.0     2.0     2.0    0.0  1.45        5       13
#&gt; x[1,19]          1.6     1.7     1.7     1.7    0.0  1.45        4       13
#&gt; x[1,20]          2.3     2.3     2.3     2.3    0.0  1.58        4       13
#&gt; Z[1,1]           1.4     1.4     1.4     1.4    0.0  1.58        4       13
#&gt; Z[2,1]          23.8    28.6    32.6    28.4    3.0  2.06        3       13
#&gt; Z[3,1]          -1.9    -1.6    -1.4    -1.6    0.2  2.06        4       13
#&gt; log_lik[1]      -1.6    -1.6    -1.6    -1.6    0.0  2.06        3       13
#&gt; log_lik[2]    -274.5  -202.5  -136.1  -203.2   47.0  2.06        3       13
#&gt; log_lik[3]      -2.0    -1.8    -1.6    -1.8    0.1  2.06        4       13
#&gt; log_lik[4]      -1.4    -1.3    -1.3    -1.3    0.0  2.06        3       13
#&gt; log_lik[5]     -13.9   -10.9    -7.7   -10.9    2.1  2.06        3       13
#&gt; log_lik[6]      -1.3    -1.3    -1.3    -1.3    0.0  2.06        3       13
#&gt; log_lik[7]      -1.6    -1.6    -1.5    -1.6    0.0  2.06        3       13
#&gt; log_lik[8]    -321.0  -234.7  -156.7  -235.8   55.9  2.06        3       13
#&gt; log_lik[9]      -1.8    -1.6    -1.5    -1.6    0.1  2.06        4       13
#&gt; log_lik[10]     -1.8    -1.8    -1.8    -1.8    0.0  1.87        4       13
#&gt; log_lik[11]   -441.1  -320.6  -211.6  -322.1   78.0  2.06        3       13
#&gt; log_lik[12]     -3.8    -3.1    -2.7    -3.1    0.3  2.06        3       13
#&gt; log_lik[13]     -1.3    -1.3    -1.3    -1.3    0.0  2.06        3       13
#&gt; log_lik[14]     -3.7    -3.3    -2.8    -3.3    0.3  2.06        3       13
#&gt; log_lik[15]     -1.4    -1.4    -1.4    -1.4    0.0  2.06        3       13
#&gt; log_lik[16]     -1.4    -1.4    -1.4    -1.4    0.0  2.06        3       13
#&gt; log_lik[17]   -261.8  -189.7  -124.5  -190.7   46.8  2.06        3       13
#&gt; log_lik[18]     -2.6    -2.3    -2.1    -2.3    0.2  2.06        3       13
#&gt; log_lik[19]     -1.3    -1.3    -1.3    -1.3    0.0  2.06        3       13
#&gt; log_lik[20]     -2.5    -2.0    -1.7    -2.0    0.3  2.06        3       13
#&gt; log_lik[21]     -1.4    -1.4    -1.4    -1.4    0.0  2.06        4       13
#&gt; log_lik[22]     -3.1    -3.0    -2.9    -3.0    0.1  2.06        3       13
#&gt; log_lik[23]   -553.1  -399.1  -261.2  -401.5   99.3  2.06        3       13
#&gt; log_lik[24]     -3.5    -2.9    -2.4    -2.9    0.4  2.06        3       13
#&gt; log_lik[25]     -1.5    -1.5    -1.5    -1.5    0.0  2.06        3       13
#&gt; log_lik[26]   -138.9   -99.4   -65.5  -100.4   25.0  2.06        3       13
#&gt; log_lik[27]     -2.6    -2.3    -2.1    -2.3    0.1  2.06        3       13
#&gt; log_lik[28]     -1.8    -1.8    -1.8    -1.8    0.0  2.06        3       13
#&gt; log_lik[29]   -971.6  -699.8  -458.4  -704.6  174.7  2.06        3       13
#&gt; log_lik[30]     -8.1    -6.4    -5.3    -6.5    0.9  2.06        3       13
#&gt; log_lik[31]     -2.0    -2.0    -2.0    -2.0    0.0  2.06        3       13
#&gt; log_lik[32]  -1645.8 -1195.9  -789.5 -1202.3  291.4  2.06        3       13
#&gt; log_lik[33]    -12.0    -9.4    -7.6    -9.4    1.5  2.06        3       13
#&gt; log_lik[34]     -1.5    -1.5    -1.5    -1.5    0.0  1.71        4       13
#&gt; log_lik[35]   -982.2  -706.3  -459.4  -710.6  178.1  2.06        3       13
#&gt; log_lik[36]     -7.6    -6.0    -4.9    -6.0    0.9  2.06        3       13
#&gt; log_lik[37]     -1.5    -1.5    -1.5    -1.5    0.0  2.06        3       13
#&gt; log_lik[38]   -289.0  -206.9  -135.5  -208.7   52.4  2.06        3       13
#&gt; log_lik[39]     -3.0    -2.5    -2.3    -2.5    0.2  2.06        3       13
#&gt; log_lik[40]     -1.4    -1.4    -1.3    -1.4    0.0  2.06        3       13
#&gt; log_lik[41]    -82.3   -59.7   -40.5   -60.3   14.3  2.06        3       13
#&gt; log_lik[42]     -1.4    -1.4    -1.4    -1.4    0.0  1.45        5       13
#&gt; log_lik[43]     -1.6    -1.6    -1.6    -1.6    0.0  2.06        3       13
#&gt; log_lik[44]     -6.0    -4.8    -3.4    -4.8    0.9  2.06        3       13
#&gt; log_lik[45]     -1.6    -1.6    -1.6    -1.6    0.0  1.19        5       13
#&gt; log_lik[46]     -1.3    -1.3    -1.3    -1.3    0.0  2.06        3       13
#&gt; log_lik[47]   -236.0  -173.2  -113.4  -173.3   41.5  2.06        3       13
#&gt; log_lik[48]     -3.9    -3.4    -3.0    -3.4    0.3  2.06        3       13
#&gt; log_lik[49]     -1.5    -1.5    -1.5    -1.5    0.0  2.06        4       13
#&gt; log_lik[50]   -861.5  -620.8  -398.1  -622.7  157.2  2.06        3       13
#&gt; log_lik[51]     -8.4    -6.8    -5.6    -6.8    0.9  2.06        3       13
#&gt; log_lik[52]     -2.2    -2.2    -2.1    -2.2    0.0  2.06        3       13
#&gt; log_lik[53]  -1012.5  -732.2  -472.8  -734.4  183.2  2.06        3       13
#&gt; log_lik[54]     -8.4    -6.6    -5.4    -6.7    0.9  2.06        3       13
#&gt; log_lik[55]     -1.8    -1.8    -1.7    -1.8    0.0  1.47        4       13
#&gt; log_lik[56]   -758.7  -554.9  -364.5  -555.8  133.8  2.06        3       13
#&gt; log_lik[57]     -5.0    -4.0    -3.3    -4.0    0.5  2.06        3       13
#&gt; log_lik[58]     -3.2    -3.1    -3.0    -3.1    0.1  2.06        3       13
#&gt; log_lik[59]  -1381.7 -1005.6  -656.0 -1007.9  246.6  2.06        3       13
#&gt; log_lik[60]     -6.8    -5.1    -4.0    -5.2    0.9  2.06        3       13
#&gt; psi[1]           0.5     0.5     0.5     0.5    0.0  1.19        8       13
#&gt; xstar[1,1]       0.3     1.9     3.1     1.7    1.1  1.14       10       13
#&gt; sigma[1]         1.4     1.5     1.5     1.5    0.0  2.06        3       13
#&gt; lp__        -10656.9 -7766.0 -5131.8 -7798.8 1877.9  2.06        3       13
#&gt; 
#&gt; For each parameter, Bulk_ESS and Tail_ESS are crude measures of 
#&gt; effective sample size for bulk and tail quantities respectively (an ESS &gt; 100 
#&gt; per chain is considered good), and Rhat is the potential scale reduction 
#&gt; factor on rank normalized split chains (at convergence, Rhat &lt;= 1.05).</div><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># example of observation error covariates</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>42</span><span class='op'>)</span>
<span class='va'>obs_covar</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span><span class='st'>"time"</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>20</span>,<span class='st'>"timeseries"</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>,<span class='st'>"covariate"</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>obs_covar</span><span class='op'>$</span><span class='va'>value</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>obs_covar</span><span class='op'>)</span>,<span class='fl'>0</span>,<span class='fl'>0.1</span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>fit_dfa</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span>, iter <span class='op'>=</span> <span class='fl'>50</span>, chains <span class='op'>=</span> <span class='fl'>1</span>, obs_covar<span class='op'>=</span><span class='va'>obs_covar</span><span class='op'>)</span>

<span class='co'># example of process error covariates</span>
<span class='va'>pro_covar</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span><span class='st'>"time"</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>20</span>,<span class='st'>"trend"</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>,<span class='st'>"covariate"</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>pro_covar</span><span class='op'>$</span><span class='va'>value</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>pro_covar</span><span class='op'>)</span>,<span class='fl'>0</span>,<span class='fl'>0.1</span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>fit_dfa</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span>, iter <span class='op'>=</span> <span class='fl'>50</span>, chains <span class='op'>=</span> <span class='fl'>1</span>, num_trends <span class='op'>=</span> <span class='fl'>2</span>, pro_covar<span class='op'>=</span><span class='va'>pro_covar</span><span class='op'>)</span>

<span class='co'># example of long format data</span>
<span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_dfa.html'>sim_dfa</a></span><span class='op'>(</span>num_trends <span class='op'>=</span> <span class='fl'>1</span>, num_years <span class='op'>=</span> <span class='fl'>20</span>, num_ts <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>obs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>, <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span>, <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span><span class='op'>[</span><span class='fl'>3</span>,<span class='op'>]</span><span class='op'>)</span>
<span class='va'>long</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='st'>"obs"</span> <span class='op'>=</span> <span class='va'>obs</span>, <span class='st'>"ts"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>,<span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span>, <span class='st'>"time"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>20</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>=</span> <span class='fu'>fit_dfa</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>long</span>, data_shape <span class='op'>=</span> <span class='st'>"long"</span>, iter <span class='op'>=</span> <span class='fl'>50</span>, chains <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='co'># example of long format data with obs covariates</span>
<span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_dfa.html'>sim_dfa</a></span><span class='op'>(</span>num_trends <span class='op'>=</span> <span class='fl'>1</span>, num_years <span class='op'>=</span> <span class='fl'>20</span>, num_ts <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>obs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>, <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span>, <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span><span class='op'>[</span><span class='fl'>3</span>,<span class='op'>]</span><span class='op'>)</span>
<span class='va'>long</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='st'>"obs"</span> <span class='op'>=</span> <span class='va'>obs</span>, <span class='st'>"ts"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>,<span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span>, <span class='st'>"time"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>20</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>obs_covar</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span><span class='st'>"time"</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>20</span>,<span class='st'>"timeseries"</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>,<span class='st'>"covariate"</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>)</span>
<span class='va'>obs_covar</span><span class='op'>$</span><span class='va'>value</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>obs_covar</span><span class='op'>)</span>,<span class='fl'>0</span>,<span class='fl'>0.1</span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>=</span> <span class='fu'>fit_dfa</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>long</span>, data_shape <span class='op'>=</span> <span class='st'>"long"</span>, iter <span class='op'>=</span> <span class='fl'>50</span>, chains <span class='op'>=</span> <span class='fl'>1</span>,obs_covar<span class='op'>=</span><span class='va'>obs_covar</span><span class='op'>)</span>

<span class='co'># example of model with Z constrained to be proportions and wide format data</span>
<span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_dfa.html'>sim_dfa</a></span><span class='op'>(</span>num_trends <span class='op'>=</span> <span class='fl'>1</span>, num_years <span class='op'>=</span> <span class='fl'>20</span>, num_ts <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>=</span> <span class='fu'>fit_dfa</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span>, z_model <span class='op'>=</span> <span class='st'>"proportion"</span>, iter <span class='op'>=</span> <span class='fl'>50</span>, chains <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='co'># example of model with Z constrained to be proportions and long format data</span>
<span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_dfa.html'>sim_dfa</a></span><span class='op'>(</span>num_trends <span class='op'>=</span> <span class='fl'>1</span>, num_years <span class='op'>=</span> <span class='fl'>20</span>, num_ts <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>obs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>, <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span>, <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span><span class='op'>[</span><span class='fl'>3</span>,<span class='op'>]</span><span class='op'>)</span>
<span class='va'>long</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='st'>"obs"</span> <span class='op'>=</span> <span class='va'>obs</span>, <span class='st'>"ts"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>,<span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span>, <span class='st'>"time"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>20</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>=</span> <span class='fu'>fit_dfa</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>long</span>, data_shape <span class='op'>=</span> <span class='st'>"long"</span>, z_model <span class='op'>=</span> <span class='st'>"proportion"</span>, iter <span class='op'>=</span> <span class='fl'>50</span>, chains <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='co'>#' # example of B-spline model with wide format data</span>
<span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_dfa.html'>sim_dfa</a></span><span class='op'>(</span>num_trends <span class='op'>=</span> <span class='fl'>1</span>, num_years <span class='op'>=</span> <span class='fl'>20</span>, num_ts <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>=</span> <span class='fu'>fit_dfa</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span>, iter <span class='op'>=</span> <span class='fl'>50</span>, chains <span class='op'>=</span> <span class='fl'>1</span>, trend_model <span class='op'>=</span> <span class='st'>"spline"</span>, n_knots <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='co'># example of B-spline model with wide format data</span>
<span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_dfa.html'>sim_dfa</a></span><span class='op'>(</span>num_trends <span class='op'>=</span> <span class='fl'>1</span>, num_years <span class='op'>=</span> <span class='fl'>20</span>, num_ts <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>=</span> <span class='fu'>fit_dfa</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>y_sim</span>, iter <span class='op'>=</span> <span class='fl'>50</span>, chains <span class='op'>=</span> <span class='fl'>1</span>, trend_model <span class='op'>=</span> <span class='st'>"gp"</span>, n_knots <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Eric J. Ward, Sean C. Anderson, Luis A. Damiano.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


